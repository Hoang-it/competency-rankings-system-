
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Meta tag -->
    <div th:replace="my-teamplate.html :: head/meta"></div>
    <!-- Bootstrap CSS, CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/image/brand-logo.jpg" type="image/x-icon">
    <!-- Jquery, JavaScript -->
    <div th:replace="my-teamplate.html :: head/script"></div>
    <title>Ranking Responsibilities</title>
    <style>
        @media print {
            .row {
                display: block !important;
            }
            #none-print, #navigation, #action, #mode, #roleUser, #status {
                display: none !important;
            }
            footer, header, i {
                display: none !important;
            }
            #radar {
                break-inside: avoid !important;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation menu -->
    <div th:replace="my-teamplate.html :: header"></div>
    <div id="mode" style="display: none;visibility: hidden" th:text="${mode}"></div>
    <div id="roleUser" style="display: none;visibility: hidden" th:text="${empRole}"></div>
    <div id="status" style="display: none;visibility: hidden" th:text="${profile.statusType.statusTypeName}"></div>
    <main>
        <div class="container">
            <div class="row justify-content-center">
                <!-- LEFT SIDE INFOMATION-->
                <div th:replace="/employee/employee.html :: userInfor" ></div>

                <!-- INFO DETAILS -->
                <div id="profileId" style="visibility: hidden;display: none" th:text="${profile.getRankingProfileId()}"></div>
                <div class="col-md-8 col-sm-12 text-section align-center" style="padding:10px;">
                    <h4 class="mbr-fonts-style mbr-title pb-3 display-4 text-left">myCRFâ„¢ Ranking Profile</h4>
                    <div class="container">
                        <!-- PROFILE INFO -->
                        <div class="row justify-content-center content-center vertical-menu">
                            <div class="col-md-6 text-section align-left" style="padding:10px;">
                                <ul class="mbr-fonts-style mbr-text display-7 text-left">
                                    <li>Period: <b th:text="${profile.getPeriod().getPeriodName()}">S1-2020</b></li>
                                    <li>Job Title: <b th:text="${profile.employee.getJobTitle().getJobTitleName()}">Software Engineer</b></li>
                                    <li>Rank: <b>Senior Engineer</b></li> <!-- WHERE ?-->
                                    <li>Self-Assessment Points: <b id="seft-point" th:text="${seftPoint}"></b></li>
                                    <li>Reviewed Points: <b id="review-point" th:text="${reviewPoint}"></b></li> <!-- RESULT PROFILE-->
                                </ul>
                            </div>
                            <div class="col-md-6 text-section align-left" style="padding:10px;">
                                <ul class="mbr-fonts-style mbr-text display-7 text-left">
                                    <li>Period: <b>S2-2020</b></li>
                                    <li>Profile title: <b th:text="${profile.getTitle()}">JavaFX and Oracle Engineer.</b></li>
                                    <li>Pattern: <b th:text="${pattern.getPatternName()}">Software Engineer</b></li>
                                    <li>Created: <b th:text="${profile.getCreated()}">1/June/2020</b></li>
                                    <li>Updated: <b th:text="${profile.getModified()}">1/June/2020</b></li>
                                </ul>
                            </div>
                        </div>

                        <!-- NAVIGATION BAR -->
                        <div class="row justify-content-center content-center vertical-menu" >
                            <div class="col-md-12 text-section align-left" style="padding:10px;" >
                                <p id="navigation" class="mbr-fonts-style mbr-text display-7 text-center">

                                </p>
                            </div>
                        </div>

                        <!--PROFILE DETAILS INFO -->
                        <div  class="row justify-content-center content-center">
                            <div id="profile-content"  class="col-md-12 text-section align-left" style="padding:10px;">
                                <table border="0" style="width:100%;">
                                    <!-- HEADER -->
                                    <tr style="background-color:#66F5F5;">
                                        <td class="text-left" id="component"></td>
                                        <td class="text-center vertical-menu" id="source"></td>
                                        <td class="text-center vertical-menu" id="weight"><b></b></td>
                                        <td class="text-left align-center" nowrap="" style="width:135px;" id="responsive"></td>
                                    </tr>
                                    <!-- ROWS -->
                                    <tbody id="profileDetails">

                                        <tr style="background-color:#F6F5F5;">
                                            <td tr-click="table-row-0" class="text-left table-row-course-top-style">Responsibilities</td>

                                            <td class="text-center vertical-menu">
                                                <select style="width:150px;">
                                                <option value="0">Unknown</option>
                                                <option value="1">Program Manager</option>
                                                <option value="2" selected="">Project Manager</option>
                                                <option value="3">Technical Leader</option>
                                                <option value="4">Team Leader</option>
                                                <option value="5">Management Manager</option>
                                            </select>
                                            </td>

                                            <td class="text-center vertical-menu">15%</td>

                                            <td class="text-left" nowrap="" style="vertical-align:baseline;">
                                                <select style="width:150px;">
                                                <option value="0" title="None: None performs tasks">No Responsibility</option>
                                                <option value="1" title="Follow: Performs tasks under close supervision">Follow</option>
                                                <option value="2" title="Assist: Performs tasks under guideline from supervision">Assist</option>
                                                <option value="3" selected="" title="Apply: Performs tasks with limited direct supervision">Apply</option>
                                                <option value="4" title="Create: Orchestrate and Innovate the Implementation of Responsibilities">Create</option>
                                                <option value="5" title="Design: Design / Approve / Reject / Agree / Disagree">Design</option>
                                                <option value="6" title="Initiate: Performs a senior lead/management role">Initiate</option>
                                            </select>
                                            </td>
                                        </tr>

                                        <tr style="background-color:#EEEDED;">
                                            <td tr-click="table-row-1" class="text-left table-row-course-top-style">Job Roles <img image-icon="table-row-1" src="/icons/arrowUp.png" class="image-nosize"></td>
                                            <td class="text-center vertical-menu">
                                                <select style="width:150px;">
                                                <option value="0">Unknown</option>
                                                <option value="1">Program Manager</option>
                                                <option value="2" selected="">Project Manager</option>
                                                <option value="3">Technical Leader</option>
                                                <option value="4">Team Leader</option>
                                                <option value="5">Management Manager</option>
                                            </select>
                                            </td>
                                            <td class="text-center vertical-menu">5%</td>
                                            <td class="text-left align-top" nowrap="">
                                                <select style="width:150px;">
                                                    <option value="0">No Role</option>
                                                    <option value="1">Very Low</option>
                                                    <option value="2">Low</option>
                                                    <option value="3" selected="">Medium</option>
                                                    <option value="4">High</option>
                                                    <option value="5">Very High</option>
                                                </select>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Radar chart -->
                            <div class="col-md-12 align-center" id="radar">
                                <!-- Radar chart insert here! -->
                            </div>
                            <p><i>You are now can update and finish profile OR update profile and continue to rankings of Business Contributions page.</i><p>
                            <p id="action" class="mbr-fonts-style mbr-text display-7 text-left">

                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
<!-- Footer of Page -->
<div th:replace="my-teamplate.html :: footer"></div>
<script>
    let currentSelect = "#role"
    WHITE = "ðŸ”˜"
    RED = "ðŸ”´"
    BLUE = "ðŸ”µ"
    style = BLUE
    components = {}
    componentsName = []
    componentsIdName = []
    summary = {}
    saveNewValueIn = "#seft-point"
    updateNewValue = "selfPoint"
    next = {}
    seflPoint = parseInt($("#seft-point").text())
    pointComponent = {}
    mapComponentDetailToPatternDetail = {}
    profileStatue = "In-Progress"
    if ($("#roleUser").text() != "ROLE_MEMBER"){
        saveNewValueIn = "#review-point"
        updateNewValue = "reviewPoint"
    }

    let dataPost = []

    let mapDataPostVsTable = {}

    let mapSelfToPatternDetail = {}

    function calculateSeftPoint(){
        sum = 0
        //alert("Self point")
        for (i = 0; i < dataPost.length; i++){
            sum += parseFloat(dataPost[i]["selfPoint"])
        }
        //alert(sum)
        return sum.toFixed(2);
    }
    function calculateReviewPoint(){
        sum = 0
        //alert("review point")
        for (i = 0; i < dataPost.length; i++){
            //alert( dataPost[i]["patternDetailName"] + " " + dataPost[i]["reviewPoint"])
            sum += parseFloat(dataPost[i]["reviewPoint"])
        }
        //alert(sum)
        return sum.toFixed(2);
    }

    function updateProfile(){
        $("#update").click(function (){
            alert("Update?")
            $.ajax({
                type : "POST",
                contentType : "application/json",
                url : "http://localhost:8080/profile/update?role=" + $("#roleUser").text(),
                data : JSON.stringify(dataPost),
                success : function (result){
                    if ($("#roleUser").text() == "ROLE_MANAGER"){
                        alert("Go to Manager List Page")
                        window.location.href = "/manager/manage-profile";
                        return;
                    }
                    if ($("#roleUser").text() == "ROLE_LEADER"){
                        alert("Go to Manager List Page")
                        window.location.href = "/manager/manage-profile";
                        return;
                    }
                    if ($("#roleUser").text() == "ROLE_MEMBER"){
                        alert("Go to Member list page")
                        window.location.href = "/employee/my-profiles";
                        return;
                    }
                }
            })
        })
    }
    function submitProfile(){
        $("#submit").click(function (){
            alert("Submit?")
            $.ajax({
                type : "POST",
                contentType : "application/json",
                url : "http://localhost:8080/profile/submit?role=" + $("#roleUser").text() + "&pid=" + $("#profileId").text() ,
                success : function (result){
                    if ($("#roleUser").text() == "ROLE_MANAGER"){
                        alert("Go to Manager List Page")
                        window.location.href = "/manager/manage-profile";
                        return;
                    }
                    if ($("#roleUser").text() == "ROLE_LEADER"){
                        alert("Go to Manager List Page")
                        window.location.href = "/manager/manage-profile";
                        return;
                    }
                    if ($("#roleUser").text() == "ROLE_MEMBER"){
                        alert("Go to Member list page")
                        window.location.href = "/employee/my-profiles";
                        return;
                    }
                }
            })
        })
    }
    function navigate(){
        $("#action").empty()
        profileStatue = $("#status").text()
        if ($("#roleUser").text() == "ROLE_MEMBER"){
            if (profileStatue == "In-Progress"){
                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                $("#action").append("<a id=\"continue\" class=\"btn btn-outline-primary\">Update &amp; Continue</a>")
            } else{
            }
        }
        if ($("#roleUser").text() == "ROLE_LEADER"){
            if (profileStatue == "Submitted"){
                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                $("#action").append("<a id=\"continue\" class=\"btn btn-outline-primary\">Update &amp; Continue</a>")
            } else{
            }
        }
        if ($("#roleUser").text() == "ROLE_MANAGER"){
            if (profileStatue == "Reviewed"){
                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                $("#action").append("<a id=\"continue\" class=\"btn btn-outline-primary\">Update &amp; Continue</a>")
            } else{
            }
        }

        if ($("#roleUser").text() == "ROLE_MEMBER"){

            $("#seft-point").text(calculateSeftPoint())
        } else {
            $("#review-point").text(calculateReviewPoint())
        }

        $(".change").each(function(index, element){
            if ($(this).is(currentSelect)){
                $(this).text(RED)
                style = WHITE
                return;
            }
            $(this).text(style)
        })
        style = BLUE

        $("#continue").click(function (){
            currentSelect = next[currentSelect]
            $(currentSelect).click()

        });

        updateProfile()

    }

    function drawRadarChart(label, selfPoint, reviewedPoint, requiredPoint) {
        let ctx = document.getElementById('radarChart').getContext('2d');
        let radarChart = new Chart(ctx, {
            type: 'radar',
            data : {
                labels : label,
                datasets: [
                    {
                        label : "Self Ranked",
                        backgroundColor: 'rgba(0, 0, 0, 0)',
                        borderDash: [5,10],
                        borderColor: "rgba(255, 69, 0, 1)",
                        data : selfPoint
                    },
                    {
                        label : "Reviewed",
                        backgroundColor: 'rgba(0, 0, 0, 0)',
                        borderDash: [5,10],
                        borderColor: "rgba(59, 89, 152, 1)",
                        data : reviewedPoint
                    },
                    {
                        label : "Required Point",
                        backgroundColor: 'rgba(0, 0, 0, 0)',
                        borderDash: [5,10],
                        borderColor: "rgba(0, 255, 127, 1)",
                        data : requiredPoint
                    },
                ]
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                        fullSize: true,
                        text: 'Competency Ranking Profile Radar Chart',
                        color: 'rgb(255, 99, 132)',
                        font: { weight: 'bold', size: '24px' },
                        padding: { top:10, bottom: 20 }
                    }
                },
                scale: {
                    ticks: {
                        maxTicksLimit: 5
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            display: false,
                        }
                    }
                }
            }
        });
    }

    function setTableTitle(componentName, weight){
        $("#profile-content").empty()
        $("#profile-content").append(" <table id=\"table-content\" class=\"table table-borderless table-responsive-md\"></table>")
        $("#table-content").append("<tr id=\"row-title\" style=\"background-color:#66F5F5;\"></tr>")

        $("#row-title").append("<td class=\"text-left\" id=\"component\"></td>")
        $("#row-title").append("<td class=\"text-center vertical-menu\" id=\"source\"></td>")
        $("#row-title").append("<td class=\"text-center vertical-menu\" id=\"weight\"><b></b></td>")
        if ($("#roleUser").text() != "ROLE_MEMBER"){
            $("#row-title").append("<td class=\"text-left align-center\" nowrap=\"\" style=\"width:135px;\" id=\"self\"></td>")
        }

        $("#row-title").append("<td class=\"text-left align-center\" nowrap=\"\" style=\"width:135px;\" id=\"responsive\"></td>")

        $("#table-content").append("<tbody id=\"profileDetails\"></tbody>")

        $("#component").text(componentName)
        $("#source").text("Source Information")
        $("#weight").text(weight)
        $("#self").text("Self Assign")
        $("#responsive").text("Responsibility Level")
    }

    function setupTable(pid, cid){
        $.getJSON(
            "http://localhost:8080/master/profile/pattern-details-weight?id=" + pid+"&cid=" + cid,
            function (data){
                let k = 0
                $("#profileDetails").empty()

                patternDetailIds = []
                //alert(pid + " " +  cid)
                $.each(data, function (key, value){
                    $("#profileDetails").append("<tr id=row-"+ componentsIdName[k] +" style=\"background-color:#EEEDED;\"></tr>")
                    $("#row-" + componentsIdName[k]).append("<td tr-click=\"table-row-0\" class=\"text-left table-row-course-top-style\">" + value.competencyComponentDetail.componentDetailName +"</td>")
                    $("#row-" + componentsIdName[k]).append("<td class=\"text-center vertical-menu\"><select class=\"selectSource patternDetail-" + value.competencyPatternDetailId + "\" style=\"width:150px;\"></select></td>")
                    $("#row-" + componentsIdName[k]).append("<td class=\"text-center vertical-menu\ patternDetail-" + value.competencyPatternDetailId  + " weight\">"+ value.weightDetail +"</td>")
                    if ($("#roleUser").text() != "ROLE_MEMBER"){
                        $("#row-" + componentsIdName[k]).append("<td class=\"text-left\" nowrap=\"\" style=\"vertical-align:baseline;\"><select class=\"proficiency self-" + value.competencyPatternDetailId + "\" style=\"width:150px;\" disabled></select></td>")
                    }
                    $("#row-" + componentsIdName[k]).append("<td class=\"text-left\" nowrap=\"\" style=\"vertical-align:baseline;\"><select class=\"proficiency patternDetail-" + value.competencyPatternDetailId + "\" style=\"width:150px;\"></select></td>")
                    $('#radar').empty()

                    patternDetailIds.push(value.competencyPatternDetailId)
                    k++;
                })
                for (i=0; i < patternDetailIds.length;i++){
                    $.getJSON(
                        "http://localhost:8080/master/patternDetail?id=" + patternDetailIds[i],
                        function (data){
                            classPattern = ".patternDetail-" + data.competencyPatternDetailId

                            let selectRow;
                            //alert(JSON.stringify(mapSelfToPatternDetail))
                            //alert(JSON.stringify(mapDataPostVsTable))
                            if ($("#roleUser").text() != "ROLE_MEMBER"){
                                selfCopy = ".self-" + data.competencyPatternDetailId
                                $(selfCopy).each(function (){
                                    if ($(this).attr("class").includes("proficiency")){
                                        selectRow = $(this)
                                        postIndex = mapSelfToPatternDetail[selectRow.attr("class").split(" ")[1]]
                                        $.each(data.competencyComponentDetail.proficiencyLevels, function (key, val){
                                            selectRow.append("<option value=\""+ val.proficiencyLevelId + "\">" + val.proficiencyLevelName + "</option>")
                                            // alert(row.attr("class") + " " + val.proficiencyLevelName)

                                            //alert(selectRow.attr("class") + " " + postIndex)
                                            selectRow.val(dataPost[postIndex]["selfProficientId"])

                                        })
                                        selectRow.attr("disabled", true)
                                    }

                                })
                            }

                            $(classPattern).each(function (){
                                if ($(this).attr("class").includes("proficiency")){
                                    selectRow = $(this)
                                    postIndex = mapDataPostVsTable[selectRow.attr("class").split(" ")[1]]
                                    $.each(data.competencyComponentDetail.proficiencyLevels, function (key, val){
                                        selectRow.append("<option value=\""+ val.proficiencyLevelId + "\">" + val.proficiencyLevelName + "</option>")
                                        // alert(row.attr("class") + " " + val.proficiencyLevelName)

                                        //alert(row.attr("class"))
                                        selectRow.val(dataPost[postIndex]["proficientId"])

                                    })
                                    min = parseInt(selectRow.find(":first").val())
                                    max = parseInt(selectRow.find(":last").val())
                                    dataPost[postIndex]["proficientMax"] = max
                                    dataPost[postIndex]["proficientMin"] = min


                                    //$(this).append("<option value=\"0\">Unknown</option>")
                                }

                            })

                            selectRow.change(function (){
                                pattern = $(this).attr("class").split(" ")[1]
                                postIndex = mapDataPostVsTable[$(this).attr("class").split(" ")[1]]


                                ratio = ($(this).val() - dataPost[postIndex]["proficientMin"]) / (dataPost[postIndex]["proficientMax"] - dataPost[postIndex]["proficientMin"])
                                dataPost[postIndex]["proficientId"] = $(this).val()
                                //alert(ratio)
                                dataPost[postIndex][updateNewValue] = dataPost[postIndex]["weight"] * ratio
                                dataPost[postIndex]["newPoint"] = dataPost[postIndex]["weight"] * ratio
                                $("." + pattern).each(function (){
                                    if ($(this).attr("class").includes("weight")){
                                        $(this).text(dataPost[postIndex][updateNewValue].toFixed(2))
                                    }
                                })

                            })
                            //alert("End")

                        }
                    )

                }

                addDatasource();

                $(".weight").each(function (){
                    patternClass = $(this).attr("class").split(" ")[2]
                    postIndex = mapDataPostVsTable[patternClass]

                    $(this).text(dataPost[postIndex][updateNewValue].toFixed(2))
                })


                if ($("#mode").text() == "summary"){
                    $("select").attr("disabled", true)
                }

                if ($("#roleUser").text() == "ROLE_MEMBER"){
                    if (profileStatue == "In-Progress"){
                        $("select").attr("disabled", false)
                    } else{
                        $("select").attr("disabled", true)
                    }
                }
                if ($("#roleUser").text() == "ROLE_LEADER"){
                    if (profileStatue == "Submitted"){
                        $("select").attr("disabled", false)
                    } else{
                        $("select").attr("disabled", true)
                    }
                }
                if ($("#roleUser").text() == "ROLE_MANAGER"){
                    if (profileStatue == "Reviewed"){
                        $("select").attr("disabled", false)
                    } else{
                        $("select").attr("disabled", true)
                    }
                }

            }
        )
    }

    function addDatasource(){
        $.getJSON(
            "http://localhost:8080/master/datasource",
            function (data){
                let i = 0
                $.each(data, function (key, value){

                    $(".selectSource").append("<option value=\"" + value.dataSourceId +"\">" + value.dataSourceName + "</option>")
                })
                $( ".selectSource" ).each(function (){
                    postIndex = mapDataPostVsTable[$(this).attr("class").split(" ")[1]]
                    if (dataPost[postIndex]["sourceRequired"] == "required"){
                        $(this).css("display", "none")
                    }
                    $(this).val(dataPost[postIndex]["source"])

                })
                $( ".selectSource" )
                    .change(function () {
                        postIndex = mapDataPostVsTable[$(this).attr("class").split(" ")[1]]

                        dataPost[postIndex]["source"] = $(this).val()
                    })
            }
        )

    }

    $.getJSON(
        "http://localhost:8080/master/profile-details?pid=" + $("#profileId").text(),
        function (data){
            let dataPostIndex = 0
            $.each(data, function (key, value){
                //alert(pid + " " + value.rankingProfileDetailId)
                let pattern = {}
                pattern["patternDetailName"] = value.patternDetailName
                pattern["patternDetailId"] = value.patternDetailId
                pattern["profileDetailId"] = value.profileDetailId
                pattern["source"] = value.sourceId
                pattern["sourceRequired"] = value.sourceRequired
                pattern["proficientMin"] = value.proficientMin
                pattern["proficientMax"] = value.proficientMax
                pattern["weight"] = value.patternWeight
                pattern["reviewPoint"] = value.reviewPoint
                pattern["selfPoint"] = value.selfPoint
                pattern["pointOfPattern"] = value.pointOfPattern
                pattern["newPoint"] = value.point
                pattern["oldPoint"] = value.point
                pattern["selfProficientId"] = value.proficientSelfPointId
                if ($("#roleUser").text() == "ROLE_MEMBER"){
                    pattern["proficientId"] = value.proficientSelfPointId
                } else {
                    pattern["proficientId"] = value.proficientReviewPointId
                }
                dataPost.push(pattern)
                mapDataPostVsTable["patternDetail-" + pattern["patternDetailId"]] = dataPostIndex
                mapSelfToPatternDetail["self-" + pattern["patternDetailId"]] = dataPostIndex

                mapComponentDetailToPatternDetail[value.componentDetailId] = "patternDetail-" + pattern["patternDetailId"]
                dataPostIndex += 1
            })

            //alert(JSON.stringify(dataPost))
            $("#seft-point").text(calculateSeftPoint())
            $("#review-point").text(calculateReviewPoint())

            $.getJSON(
                "http://localhost:8080/master/profile/pattern-weight?id=" + $("#profileId").text(),
                function (data){
                    $.each(data, function (key, value){
                        component = {}

                        component["name"] = value.competencyComponent.componentName
                        component["weight"] = value.weight + "%"
                        component["id"] = value.competencyComponent.componentId
                        component["cdt_id"] = value.competencyComponent.componentId
                        component["patterns"] = value.competencyComponent.competencyComponentDetail
                        //alert(JSON.stringify(component["patterns"]))
                        components[value.competencyComponent.idName] = component

                        componentsName.push(value.competencyComponent.componentName)
                        componentsIdName.push(value.competencyComponent.idName)
                    })

                    let i;
                    let currentPosition = 0;

                    for (i=1; i < componentsIdName.length; i++){
                        next["#" + componentsIdName[i -1]] = "#" + componentsIdName[i]
                    }
                    next["#" + componentsIdName[i -1]] = "#summary"

                    for (i=0; i < componentsName.length; i++){
                        $("#navigation").append(
                            "---<a class=\"change\" id=\"" + componentsIdName[i] + "\" title=\"" + componentsName[i] + "\">" + WHITE + "</a>"
                        )
                    }


                    $("#navigation").append("---<a class=\"change\" id=\"summary\" title=\"Profile Ranking Summary\">ðŸ”˜</a>---")

                    //alert(JSON.stringify(dataPost))
                    $("#role").click(function (){
                        currentSelect = "#" + "role"
                        component = components["role"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()

                    });

                    $("#bussiness").click(function (){
                        currentSelect = "#" + "bussiness"
                        component = components["bussiness"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#professional").click(function (){
                        currentSelect = "#" + "professional"
                        component = components["professional"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#knowledge").click(function(){
                        currentSelect = "#" + "knowledge"
                        component = components["knowledge"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#engineer").click(function (){

                        currentSelect = "#" + "engineer"
                        component = components["engineer"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#nonEngineer").click(function (){

                        currentSelect = "#" + "nonEngineer"
                        component = components["nonEngineer"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#management").click(function (){
                        currentSelect = "#" + "management"
                        component = components["management"]

                        setTableTitle(component["name"], component["weight"])

                        setupTable($("#profileId").text(), component["id"])
                        navigate()
                    });

                    $("#summary").click(function (){
                        currentSelect = "#summary"
                        navigate()

                        $("#action").empty()

                        if ($("#roleUser").text() == "ROLE_MEMBER"){
                            if (profileStatue == "In-Progress"){
                                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                                updateProfile()

                                $("#action").append("<a id=\"submit\" class=\"btn btn-outline-success\">Submit</a>")
                                submitProfile()
                            }
                        }
                        if ($("#roleUser").text() == "ROLE_LEADER"){
                            if (profileStatue == "Submitted"){
                                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                                updateProfile()

                                $("#action").append("<a id=\"submit\" class=\"btn btn-outline-success\">Submit</a>")
                                submitProfile()
                            }
                        }
                        if ($("#roleUser").text() == "ROLE_MANAGER"){
                            if (profileStatue == "Reviewed"){
                                $("#action").append("<a id=\"update\" class=\"btn btn-outline-success\">Update</a>")
                                updateProfile()

                                $("#action").append("<a id=\"submit\" class=\"btn btn-outline-success\">Submit</a>")
                                submitProfile()
                            }
                        }


                        $("#profile-content").empty()
                        $("#profile-content").append("<table id=\"summary-table\" class=\"table table-bordered table-responsive-md\"></table>")
                        $("#summary-table").append("<tr id=\"row-title\" tr-click=\"table-row-0\" style=\"background-color:rgba(75, 192, 192, 0.8);\"></tr>")
                        $("#row-title").append("<td class=\"text-left\">Component Name</td>")
                        $("#row-title").append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">Weight</td>")
                        $("#row-title").append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">Self Point</td>")
                        $("#row-title").append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">Review Point</td>")
                        $("#row-title").append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">Required Point</td>")
                        $('#radar').empty()
                        $('#radar').append("<canvas id=\"radarChart\"></canvas>")
                        // alert(JSON.stringify(components))
                        // alert(Object.keys(components).length)

                        /* Data for radar chart */
                        let selfRanked = []
                        let reviewedPoint = []
                        let pointPattern = []

                        i = 0
                        arow = 0
                        for (i; i< Object.keys(components).length; i++){
                            p = components[Object.keys(components)[i]]["patterns"]
                            //alert(JSON.stringify(p))
                            //alert(JSON.stringify(mapComponentDetailToPatternDetail))
                            self = 0
                            review = 0
                            requiredPoint = 0
                            listPattern = []
                            for (j=0;j < p.length; j++){

                                pttn = mapComponentDetailToPatternDetail[p[j].componentDetailId]
                                if (pttn != undefined){
                                    self += dataPost[mapDataPostVsTable[pttn]]["selfPoint"]
                                    review += dataPost[mapDataPostVsTable[pttn]]["reviewPoint"]
                                    requiredPoint += dataPost[mapDataPostVsTable[pttn]]["pointOfPattern"]
                                    listPattern.push(mapDataPostVsTable[pttn])
                                }
                            }
                            //alert(rank)
                            c = components[Object.keys(components)[i]]
                            $("#summary-table").append("<tr id=\"row-"+ i +"\" tr-click=\"table-row-0\" style=\"background-color:#F6F5F5;\"></tr>")
                            $("#row-" + i).append("<td class=\"text-left pattern-name\">" + c["name"] + "</td>")
                            $("#row-" + i).append("<td class=\"text-left align-top pattern-weight\" nowrap=\"\" style=\"width:10%;\">" + c["weight"] + "</td>")
                            $("#row-" + i).append("<td class=\"text-left align-top pattern-rank \" nowrap=\"\" style=\"width:10%;\">" + self.toFixed(2) + "</td>")
                            $("#row-" + i).append("<td class=\"text-left align-top pattern-review\" nowrap=\"\" style=\"width:10%;\">" + review.toFixed(2) + "</td>")
                            $("#row-" + i).append("<td class=\"text-left align-top pattern-required-point\" nowrap=\"\" style=\"width:10%;\">" + requiredPoint.toFixed(2) + "</td>")

                            selfRanked.push(self)
                            reviewedPoint.push(review)
                            pointPattern.push(requiredPoint)

                            for (k = 0; k < listPattern.length; k++){
                                $("#summary-table").append("<tr id=\"arow-" + arow + "\" class=\"append-row-" + i + "\" tr-click=\"table-row-0\" style=\"visibility: visible; display : table-row; background-color: rgba(255, 99, 132, 0.5);\"></tr>")
                                $("#arow-" + arow).append("<td class=\"text-left\">" + dataPost[listPattern[k]]["patternDetailName"] + "</td>")
                                $("#arow-" + arow).append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">" + dataPost[listPattern[k]]["weight"] + "</td>")
                                $("#arow-" + arow).append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">" + dataPost[listPattern[k]]["selfPoint"].toFixed(2) + "</td>")
                                $("#arow-" + arow).append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">" + dataPost[listPattern[k]]["reviewPoint"].toFixed(2) + "</td>")
                                $("#arow-" + arow).append("<td class=\"text-left align-top\" nowrap=\"\" style=\"width:10%;\">" + dataPost[listPattern[k]]["pointOfPattern"].toFixed(2) + "</td>")
                                arow++;
                            }

                        }

                        /* Draw Radar Chart */
                        drawRadarChart(componentsName, selfRanked, reviewedPoint, pointPattern);

                        //$("#profile-content").text("THIS IS SUMMARY")
                        w = 0
                        r = 0
                        v = 0
                        p = 0

                        $(".pattern-weight").each(function (){
                            w += parseInt($(this).text().slice(0, -1))
                        })
                        $(".pattern-rank").each(function (){
                            r += parseFloat($(this).text())
                        })
                        $(".pattern-review").each(function (){
                            v += parseFloat($(this).text())
                        })
                        $(".pattern-required-point").each(function (){
                            p += parseFloat($(this).text())
                        })
                        $("#summary-table").append("<tr id=\"row-"+ i +"\" tr-click=\"table-row-0\" style=\"background-color:rgba(255, 159, 64, 0.8);\"></tr>")
                        $("#row-" + i).append("<td class=\"text-left font-weight-bold\">" + "Total :" + "</td>")
                        $("#row-" + i).append("<td class=\"text-left font-weight-bold pattern-weight\" nowrap=\"\" style=\"width:10%;\">" + w + '%' + "</td>")
                        $("#row-" + i).append("<td class=\"text-left font-weight-bold pattern-rank \" nowrap=\"\" style=\"width:10%;\">" + r.toFixed(2) + "</td>")
                        $("#row-" + i).append("<td class=\"text-left font-weight-bold pattern-review\" nowrap=\"\" style=\"width:10%;\">" + v.toFixed(2) + "</td>")
                        $("#row-" + i).append("<td class=\"text-left font-weight-bold pattern-required-point\" nowrap=\"\" style=\"width:10%;\">" + p.toFixed(2) + "</td>")

                        $(".pattern-name").click(function (){
                            rowid = $(this).parent().attr("id").split("-")[1]
                            if ($(".append-row-" + rowid).css("visibility") == "hidden"){
                                $(".append-row-" + rowid).css("visibility", "visible")
                                $(".append-row-" + rowid).css("display", "table-row")
                                return;
                            }
                            if ($(".append-row-" + rowid).css("visibility") == "visible"){
                                $(".append-row-" + rowid).css("visibility", "hidden")
                                $(".append-row-" + rowid).css("display", "none")
                                return;
                            }

                        })

                    });

                    if ($("#mode").text() == "summary"){
                        $("#summary").click()
                    } else {
                        $("#" + componentsIdName[0]).click()
                    }


                })

        }
    )

</script>


</body>

</html>